# Задание 3. Ансамбли алгоритмов для решения задачи регрессии. Веб-сервер

**Практикум 317 группы, ММП ВМК, 2025**

---

## Сроки

- **Начало выполнения:** 20 ноября 2025 года, 7:00
- **Мягкий дедлайн:** 06 декабря 2025 года, 23:30
- **Жёсткий дедлайн:** 13 декабря 2025 года, 23:30

---

## Формулировка задания

### 1. Реализация алгоритмов (10 баллов)

Написать на языке Python собственную реализацию методов:
- **Случайный лес (Random Forest)**
- **Градиентный бустинг (Gradient Boosting)**

**Требования:**
- Использовать стандартные средства Python, библиотеки `numpy`, `scipy`, `matplotlib`
- Из `scikit-learn` разрешено импортировать **только** `DecisionTreeRegressor`
- Реализация должна соответствовать классическим алгоритмам из лекций ММРО

**Структура шаблона:**
```
ensembles/
├── __init__.py
├── boosting.py        # Градиентный бустинг
├── random_forest.py   # Случайный лес
└── utils.py           # Вспомогательные функции

backend/
├── __init__.py
├── app.py             # FastAPI приложение
└── schemas.py         # Pydantic схемы

frontend/
├── __init__.py
├── client.py          # Клиент для общения с бэкендом
└── utils.py           # Утилиты
```

---

### 2. Эксперименты (15 баллов)

**Датасет:** House Sales in King County, USA (данные о продажах недвижимости)

#### 2.1. Предобработка данных
- Провести предобработку данных
- Разделить данные на обучение и контроль
- Описать выполненную предобработку в отчёте

#### 2.2. Исследование случайного леса

Изучить зависимость **RMSE** на отложенной выборке и **время работы** от факторов:
- Количество деревьев в ансамбле
- Размерность подвыборки признаков для одной вершины дерева (`max_features`)
- Максимальная глубина дерева (`max_depth`), включая случай без ограничения

#### 2.3. Исследование градиентного бустинга

Изучить зависимость **RMSE** на отложенной выборке и **время работы** от факторов:
- Количество деревьев в ансамбле
- Размерность подвыборки признаков для одной вершины дерева
- Максимальная глубина дерева, включая случай без ограничения
- Значение `learning_rate`

> **Замечание:** Для исследования зависимости от количества деревьев не обязательно с нуля переобучать модель.

---

### 3. Реализация веб-сервера (15 баллов)

Спроектировать HTTP API и веб-интерфейс для взаимодействия с моделью.

**Назначение:** обучение моделей человеком, который не знает Python.

#### Требуемая функциональность:

1. **Создание новой модели**
   - Выбор гиперпараметров
   - Загрузка датасета (`.csv` файл с целевой переменной и признаками)

2. **Просмотр информации о модели**
   - Отображение полученных кривых обучения

3. **Инференс**
   - Предсказание с использованием ранее обученной модели

#### Технические требования:

- **Backend:** FastAPI
  - Все ручки в подмодуле `app.py`
  - Все аргументы аннотированы (`Annotated[]`)
  - Возвращаемые значения аннотированы (`->` или `response_model`)

- **Frontend:** Streamlit (файл `ui.py`)
  - Файл запрещено модифицировать, кроме бонусного задания

---

### 4. Docker (входит в веб-сервер)

- Обернуть решение в Docker
- Загрузить образ на dockerhub.com
- Использовать `docker-compose.yml` для запуска двух сервисов (фронт и бэк)

---

### 5. Ведение проекта (10 баллов)

**Структура репозитория:**
```
github.com/<nick>/<repo>/
├── ensembles/
│   └── ...
├── requirements.txt
├── Dockerfile
├── docker-compose.yml
├── report.pdf
├── README.md
└── ...
```

#### Требования к качественному ведению:

1. Основная разработка в **отдельных ветках**, не в `master`
2. Одно важное изменение — один коммит
3. Обновление `master` через **pull request** и **merge**
4. Понятные и содержательные сообщения коммитов и описания PR

#### Требования к коду:

Код должен проходить проверку линтерами:

```bash
# Dockerfile
cat Dockerfile | docker run --rm -i hadolint/hadolint

# Shell scripts
docker run --rm -v "/path/to/script/folder:/mnt" koalaman/shellcheck:stable script.sh

# Python
flake8 script.py --max-line-length=120
pylint script.py --max-line-length=120 --disable="C0103,C0114,C0115"
```

#### README.md должен содержать:

- Инструкцию по использованию системы
- Как собирать Docker-образ и запускать контейнер
- Инструкцию по использованию всех функций приложения
- Иллюстрации и скриншоты (желательно)

---

### 6. Отчёт

- Формат: **PDF**
- Подготовлен в системе **LaTeX**
- Закоммичен как `report.pdf`

---

## Бонусная часть (до 10 баллов)

Добавить функционал для **сравнения нескольких экспериментов**:
- Выбор существующих экспериментов чекбоксами
- Отображение кривых обучения на одном графике

---

## Распределение баллов

| Часть | Баллы |
|-------|-------|
| Реализация алгоритмов | 10 |
| Эксперименты | 15 |
| Веб-сервер | 15 |
| Ведение проекта | 10 |
| **Итого** | **50** |
| Бонус | до 10 |

---

## Литература

1. Воронцов К. В. *Линейные ансамбли* — [ссылка](http://www.machinelearning.ru/wiki/images/3/3a/Voron-ML-Compositions1-slides.pdf), 2021
2. Воронцов К. В. *Продвинутые методы ансамблирования* — [ссылка](http://www.machinelearning.ru/wiki/images/2/21/Voron-ML-Compositions-slides2.pdf), 2021
3. ММРО Лекция. *Введение в ансамбли алгоритмов* — [ссылка](https://github.com/mmp-mmro-team/mmp_mmro_fall_2024/blob/main/seminars/Seminar_11_intro_to_ensembles/lect.pdf), 2024
